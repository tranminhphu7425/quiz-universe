import{d as I,u as Y,e as D,r as a,j as e,N as F,F as k,S as L,m as w,f as M}from"./index-Bw3ot1Hh.js";import{U as P,E as j}from"./major-universityApi-AzXzY33j.js";import{G as T}from"./graduation-cap-BB9MErCi.js";import{B}from"./building-2-CQLFsIzG.js";import{C as _}from"./circle-check-CzToHRxY.js";import{A as K}from"./arrow-right-BwzJ58R4.js";function J(){const m=I(),{user:n}=Y(),y=D(),[N,C]=a.useState([]),[d,S]=a.useState(null),[g,E]=a.useState([]),[r,c]=a.useState(null);if(!y.state?.fromRegister)return e.jsx(F,{to:"/404",replace:!0});a.useEffect(()=>{console.log("Xin chao",n)},[n]);const[i,h]=a.useState(n?.intakeYear??void 0),[x,b]=a.useState(!1),[p,f]=a.useState(null),[v,u]=a.useState(null),[R,U]=a.useState(!0);a.useEffect(()=>{i||h(new Date().getFullYear())},[]);const l=!!d&&!!r;async function A(t){if(t.preventDefault(),!l)return u("Vui lòng chọn trường và chuyên ngành.");b(!0),u(null),f(null);try{const s={university:d,major:r,intakeYear:i};console.log(s),await P.setupProfile(s).catch(()=>{});const o={...n||{},university:d,major:r,intakeYear:i};localStorage.setItem("auth_user",JSON.stringify(o)),f("Đã lưu thiết lập."),setTimeout(()=>m("/dashboard"),300)}catch(s){u(s?.message||"Lưu thất bại, thử lại sau.")}finally{b(!1)}}return a.useEffect(()=>{async function t(){try{const[s,o]=await Promise.all([j.getUniversities(),j.getMajors()]);C(s),E(o),console.log(o)}finally{U(!1)}}t()},[]),e.jsxs("div",{className:"relative min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-600 via-green-600 to-emerald-500 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900"}),e.jsx(k,{distance:12,duration:7,className:"pointer-events-none absolute top-14 left-6",children:e.jsx("div",{className:"rounded-xl bg-gradient-to-br from-amber-300 to-rose-300 px-3 py-1 shadow-lg -rotate-6",children:e.jsx("span",{className:"text-xs font-black text-rose-700",children:"SETUP"})})}),e.jsx(k,{distance:10,duration:6,className:"pointer-events-none absolute top-10 right-8",children:e.jsx("div",{className:"rounded-full bg-gradient-to-br from-purple-400 to-indigo-400 p-3 shadow-xl rotate-12",children:e.jsx(L,{className:"h-4 w-4 text-white"})})}),e.jsxs("div",{className:"relative z-10 mx-auto max-w-3xl px-6 py-16",children:[e.jsxs("div",{className:"mb-6 text-center text-white",children:[e.jsxs("div",{className:"mx-auto inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-semibold ring-1 ring-white/20 backdrop-blur",children:[e.jsx(T,{className:"h-4 w-4"})," Thiết lập ban đầu"]}),e.jsx("h1",{className:"mt-3 text-3xl font-black leading-tight",children:"Chọn trường đại học & chuyên ngành"}),e.jsx("p",{className:"mt-1 text-white/85",children:"Chúng mình sẽ cá nhân hoá nội dung, bộ môn và đề thi phù hợp với bạn."})]}),e.jsxs(w.form,{onSubmit:A,initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:160,damping:18},className:"rounded-2xl border border-white/20 bg-white/10 p-5 backdrop-blur-md shadow-xl dark:border-slate-700 dark:bg-slate-800/60",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Trường của bạn"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[1fr_auto]",children:[e.jsxs("select",{title:"university",onChange:t=>S(t.target.value),className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10",children:[e.jsx("option",{value:"",children:"— Chọn trường —"}),N.map(t=>e.jsx("option",{value:t.universityCode,children:t.universityName},t.universityCode))]}),e.jsxs("button",{type:"button",onClick:()=>window.open("/app/admin/tenants","_self"),className:"rounded-xl border border-white/30 bg-white/10 px-3 py-2 text-xs font-medium text-white hover:bg-white/15 dark:bg-white/5 dark:text-slate-200 dark:border-slate-600",title:"Quản trị trường (Admin)",children:[e.jsx(B,{className:"mr-1 inline h-4 w-4"})," Danh sách trường"]})]}),e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Chuyên ngành"}),g.length>0?e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[1fr_auto]",children:[e.jsxs("select",{title:"major",onChange:t=>c(Number(t.target.value)),className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10",children:[e.jsx("option",{value:0,children:"— Chọn chuyên ngành —"}),g.map(t=>e.jsx("option",{value:t.majorId,children:t.majorName},t.majorId)),e.jsx("option",{value:void 0,children:"Khác (tự nhập)…"})]}),r===void 0&&e.jsx("input",{autoFocus:!0,placeholder:"Nhập chuyên ngành của bạn",className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10 sm:col-start-1",onChange:t=>c(Number(t.target.value))})]}):e.jsx("input",{onChange:t=>c(Number(t.target.value)),placeholder:"VD: Kỹ thuật phần mềm",className:"mb-4 w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10"}),e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Khoá/năm vào học (không bắt buộc)"}),e.jsx("input",{title:"intakeYear",type:"number",value:i??"",onChange:t=>h(t.target.value?Number(t.target.value):void 0),min:2e3,max:new Date().getFullYear()+1,className:"mb-2 w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10"}),v&&e.jsx("div",{className:"mb-3 rounded-lg bg-rose-500/15 px-3 py-2 text-sm text-rose-50 ring-1 ring-rose-500/30 dark:bg-rose-900/20 dark:text-rose-200 dark:ring-rose-800",children:v}),p&&e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-800 ring-1 ring-emerald-300 dark:bg-emerald-900/30 dark:text-emerald-300 dark:ring-emerald-800",children:[e.jsx(_,{className:"h-4 w-4"})," ",p]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[e.jsxs(w.button,{whileHover:{scale:l?1.02:1},whileTap:{scale:l?.98:1},type:"submit",disabled:!l||x,className:"inline-flex items-center gap-2 rounded-full bg-yellow-400 px-6 py-2.5 font-semibold text-emerald-950 shadow hover:brightness-105 disabled:opacity-60",children:[x?e.jsx(M,{className:"h-4 w-4 animate-spin"}):e.jsx(K,{className:"h-4 w-4"})," Lưu & tiếp tục"]}),e.jsx("button",{type:"button",onClick:()=>m("/dashboard"),className:"rounded-full bg-white/10 px-5 py-2.5 text-sm font-medium text-white ring-1 ring-white/25 hover:bg-white/15 dark:bg-white/5 dark:ring-white/10",children:"Bỏ qua bây giờ"})]})]}),e.jsxs("p",{className:"mt-4 text-center text-xs text-white/80",children:["Bạn có thể thay đổi lại ở ",e.jsx("b",{children:"Cài đặt tài khoản → Hồ sơ"})," sau này."]})]})]})}export{J as default};
