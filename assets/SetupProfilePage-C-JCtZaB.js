import{c as E,d as M,u as I,e as Y,r as a,j as e,N as D,F as w,S as F,m as j,f as P,s as T}from"./index-f1k6-leX.js";import{B as U}from"./building-2-_20YbPVA.js";import{C as A}from"./circle-check-Bl5AtR2v.js";import{A as B}from"./arrow-right-DREsCoUQ.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=[["path",{d:"M21.42 10.922a1 1 0 0 0-.019-1.838L12.83 5.18a2 2 0 0 0-1.66 0L2.6 9.08a1 1 0 0 0 0 1.832l8.57 3.908a2 2 0 0 0 1.66 0z",key:"j76jl0"}],["path",{d:"M22 10v6",key:"1lu8f3"}],["path",{d:"M6 12.5V16a6 3 0 0 0 12 0v-3.5",key:"1r8lef"}]],R=E("graduation-cap",K);async function V(){const s=await fetch("/api/universities");if(!s.ok)throw new Error("Lỗi khi lấy danh sách trường");return s.json()}async function z(){const s=await fetch("/api/majors");if(!s.ok)throw new Error("Lỗi khi lấy danh sách ngành");return s.json()}function Q(){const s=M(),{user:i}=I(),v=Y(),[y,N]=a.useState([]),[l,C]=a.useState(),[m,S]=a.useState([]);if(!v.state?.fromRegister)return e.jsx(D,{to:"/404",replace:!0});a.useEffect(()=>{console.log("Xin chao",i)},[i]),typeof window<"u"&&localStorage.getItem("auth_token");const[n,u]=a.useState(i?.major?.majorId??""),[o,g]=a.useState(i?.intakeYear??void 0),[x,p]=a.useState(!1),[b,f]=a.useState(null),[k,h]=a.useState(null),[H,_]=a.useState(!0);a.useEffect(()=>{o||g(new Date().getFullYear())},[]);const d=!!l&&!!n.trim();async function L(t){if(t.preventDefault(),!d)return h("Vui lòng chọn trường và chuyên ngành.");p(!0),h(null),f(null);try{const r={university:l,major:n.trim(),intakeYear:o};console.log(r),await T(r).catch(()=>{});const c={...i||{},university:l,major:n.trim(),intakeYear:o};localStorage.setItem("auth_user",JSON.stringify(c)),f("Đã lưu thiết lập."),setTimeout(()=>s("/dashboard"),300)}catch(r){h(r?.message||"Lưu thất bại, thử lại sau.")}finally{p(!1)}}return a.useEffect(()=>{async function t(){try{const[r,c]=await Promise.all([V(),z()]);N(r),S(c),console.log(c)}finally{_(!1)}}t()},[]),e.jsxs("div",{className:"relative min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-600 via-green-600 to-emerald-500 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900"}),e.jsx(w,{distance:12,duration:7,className:"pointer-events-none absolute top-14 left-6",children:e.jsx("div",{className:"rounded-xl bg-gradient-to-br from-amber-300 to-rose-300 px-3 py-1 shadow-lg -rotate-6",children:e.jsx("span",{className:"text-xs font-black text-rose-700",children:"SETUP"})})}),e.jsx(w,{distance:10,duration:6,className:"pointer-events-none absolute top-10 right-8",children:e.jsx("div",{className:"rounded-full bg-gradient-to-br from-purple-400 to-indigo-400 p-3 shadow-xl rotate-12",children:e.jsx(F,{className:"h-4 w-4 text-white"})})}),e.jsxs("div",{className:"relative z-10 mx-auto max-w-3xl px-6 py-16",children:[e.jsxs("div",{className:"mb-6 text-center text-white",children:[e.jsxs("div",{className:"mx-auto inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-semibold ring-1 ring-white/20 backdrop-blur",children:[e.jsx(R,{className:"h-4 w-4"})," Thiết lập ban đầu"]}),e.jsx("h1",{className:"mt-3 text-3xl font-black leading-tight",children:"Chọn trường đại học & chuyên ngành"}),e.jsx("p",{className:"mt-1 text-white/85",children:"Chúng mình sẽ cá nhân hoá nội dung, bộ môn và đề thi phù hợp với bạn."})]}),e.jsxs(j.form,{onSubmit:L,initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:160,damping:18},className:"rounded-2xl border border-white/20 bg-white/10 p-5 backdrop-blur-md shadow-xl dark:border-slate-700 dark:bg-slate-800/60",children:[e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Trường của bạn"}),e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[1fr_auto]",children:[e.jsxs("select",{title:"university",value:l??"",onChange:t=>C(t.target.value),className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10",children:[e.jsx("option",{value:"",disabled:!0,children:"— Chọn trường —"}),y.map(t=>e.jsx("option",{value:t.universityCode,children:t.universityName},t.universityCode))]}),e.jsxs("button",{type:"button",onClick:()=>window.open("/app/admin/tenants","_self"),className:"rounded-xl border border-white/30 bg-white/10 px-3 py-2 text-xs font-medium text-white hover:bg-white/15 dark:bg-white/5 dark:text-slate-200 dark:border-slate-600",title:"Quản trị trường (Admin)",children:[e.jsx(U,{className:"mr-1 inline h-4 w-4"})," Danh sách trường"]})]}),e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Chuyên ngành"}),m.length>0?e.jsxs("div",{className:"mb-4 grid gap-2 sm:grid-cols-[1fr_auto]",children:[e.jsxs("select",{title:"major",value:n,onChange:t=>u(t.target.value),className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10",children:[e.jsx("option",{value:"",children:"— Chọn chuyên ngành —"}),m.map(t=>e.jsx("option",{value:t.majorId,children:t.majorName},t.majorId)),e.jsx("option",{value:"__other__",children:"Khác (tự nhập)…"})]}),n==="__other__"&&e.jsx("input",{autoFocus:!0,placeholder:"Nhập chuyên ngành của bạn",className:"w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10 sm:col-start-1",onChange:t=>u(t.target.value)})]}):e.jsx("input",{value:n,onChange:t=>u(t.target.value),placeholder:"VD: Kỹ thuật phần mềm",className:"mb-4 w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10"}),e.jsx("label",{className:"mb-2 block text-sm font-medium text-white dark:text-slate-100",children:"Khoá/năm vào học (không bắt buộc)"}),e.jsx("input",{title:"intakeYear",type:"number",value:o??"",onChange:t=>g(t.target.value?Number(t.target.value):void 0),min:2e3,max:new Date().getFullYear()+1,className:"mb-2 w-full rounded-xl bg-white/85 px-3 py-2 text-sm text-slate-800 ring-1 ring-black/10 focus:outline-none focus:ring-2 focus:ring-emerald-400 dark:bg-slate-900/70 dark:text-slate-100 dark:ring-white/10"}),k&&e.jsx("div",{className:"mb-3 rounded-lg bg-rose-500/15 px-3 py-2 text-sm text-rose-50 ring-1 ring-rose-500/30 dark:bg-rose-900/20 dark:text-rose-200 dark:ring-rose-800",children:k}),b&&e.jsxs("div",{className:"mb-3 inline-flex items-center gap-2 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-800 ring-1 ring-emerald-300 dark:bg-emerald-900/30 dark:text-emerald-300 dark:ring-emerald-800",children:[e.jsx(A,{className:"h-4 w-4"})," ",b]}),e.jsxs("div",{className:"mt-2 flex flex-wrap items-center gap-3",children:[e.jsxs(j.button,{whileHover:{scale:d?1.02:1},whileTap:{scale:d?.98:1},type:"submit",disabled:!d||x,className:"inline-flex items-center gap-2 rounded-full bg-yellow-400 px-6 py-2.5 font-semibold text-emerald-950 shadow hover:brightness-105 disabled:opacity-60",children:[x?e.jsx(P,{className:"h-4 w-4 animate-spin"}):e.jsx(B,{className:"h-4 w-4"})," Lưu & tiếp tục"]}),e.jsx("button",{type:"button",onClick:()=>s("/dashboard"),className:"rounded-full bg-white/10 px-5 py-2.5 text-sm font-medium text-white ring-1 ring-white/25 hover:bg-white/15 dark:bg-white/5 dark:ring-white/10",children:"Bỏ qua bây giờ"})]})]}),e.jsxs("p",{className:"mt-4 text-center text-xs text-white/80",children:["Bạn có thể thay đổi lại ở ",e.jsx("b",{children:"Cài đặt tài khoản → Hồ sơ"})," sau này."]})]})]})}export{Q as default};
