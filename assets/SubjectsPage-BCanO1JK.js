import{c as x,r as s,u as I,j as e,m as w,L as d,F as T,B as P,f as D,g as H,_ as R,T as B,H as C,e as O}from"./index-CUZZxpfO.js";import{F as U,f as _}from"./favoriteApi-HpZDE46m.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],K=x("chevron-left",V);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],F=x("circle-plus",Q);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],M=x("funnel",W);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],G=x("search",X);function ne(){const[r,c]=s.useState(""),[y,ee]=s.useState("all"),[te,ae]=s.useState("all"),[A,L]=s.useState(!1),[se,j]=s.useState(null),[E,v]=s.useState(!0),[h,k]=s.useState([]),g=I()?.user,[i,u]=s.useState(1),p=6,[o,f]=s.useState(new Set),$=async t=>{const a=o.has(t);try{a?(await _.delete(`/subjects/${t}/favorite?userId=${g?.id}`),f(l=>{const m=new Set(l);return m.delete(t),m})):(await _.post(`/subjects/${t}/favorite?userId=${g?.id}`),f(l=>new Set(l).add(t)))}catch(l){console.error("Lỗi khi cập nhật yêu thích",l)}};s.useEffect(()=>{(async()=>{const a=await fetch(`/api/subjects/favorites?userId=${g?.id}`);if(a.ok){const l=await a.json();f(new Set(l.map(m=>m.id)))}else console.error("Lỗi khi lấy danh sách yêu thích")})()},[]),s.useEffect(()=>{console.log("Favorite subjects updated:",o)},[o]);async function z(){const t=new AbortController;return v(!0),j(null),(async()=>{try{const a=await H(t.signal);k(a)}catch(a){if(a?.name==="AbortError")return;j("Không thể lấy dữ liệu từ API. Đang dùng dữ liệu cục bộ!");const l=await R(()=>import("./subjects-BKC00LGv.js"),[]);k(l.default??[])}finally{v(!1)}})(),()=>t.abort()}s.useEffect(()=>{z()},[]);const n=s.useMemo(()=>{const t=N(r);return t?h.filter(a=>[a.code,a.name,a.description??""].some(l=>N(l).includes(t))):h},[r,h]);function N(t){return t.normalize("NFD").replace(/[\u0300-\u036f]/g,"").toLowerCase().trim()}const b=Math.max(1,Math.ceil(n.length/p));n.slice((i-1)*p,i*p);const S=t=>a=>{t(a),u(1)},q=s.useMemo(()=>encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' width='160' height='160' viewBox='0 0 160 160' fill='none'>
          <g stroke='#10b981' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'>
            <path d='M28 36h40a8 8 0 018 8v44H36a8 8 0 01-8-8V36z' opacity='0.7'/>
            <path d='M28 52h48' opacity='0.6'/>
            <rect x='96' y='28' width='36' height='28' rx='4' />
            <path d='M100 36h18M100 44h18' opacity='0.6'/>
          </g>
        </svg>
      `),[]);return e.jsxs("div",{className:"relative min-h-screen bg-slate-50 dark:bg-slate-950",children:[e.jsxs("section",{className:"relative overflow-hidden",children:[e.jsx("div",{className:`absolute inset-0  bg-gradient-to-r from-emerald-500 via-green-500 to-emerald-400\r
                  dark:from-gray-900 dark:via-gray-800 dark:to-gray-900`}),e.jsx("div",{"aria-hidden":!0,className:"pointer-events-none absolute inset-y-0 left-0 w-[120%] md:w-full opacity-10 dark:opacity-[0.15]",style:{backgroundImage:`url("data:image/svg+xml;utf8,${q}")`,backgroundRepeat:"repeat",backgroundSize:"160px 160px",maskImage:"radial-gradient(1200px 400px at left center, #000 70%, transparent 100%)",WebkitMaskImage:"radial-gradient(1200px 400px at left center, #000 70%, transparent 100%)"}}),e.jsx("div",{className:"pointer-events-none absolute z-0 -left-24 -top-24 h-72 w-72 rounded-full bg-white/10 blur-2xl dark:bg-emerald-400/20"}),e.jsx("div",{className:"pointer-events-none absolute z-0 -right-16 top-10 h-64 w-64 rounded-full bg-white/10 blur-2xl dark:bg-purple-400/20"}),e.jsxs(w.div,{className:"relative z-10 text-center mx-auto max-w-6xl px-6 py-20",children:[e.jsxs("div",{className:"mb-6 flex flex-col items-start justify-between gap-4 sm:flex-row sm:items-center ",children:[e.jsxs("div",{className:"w-full lg:w-auto",children:[e.jsx("h1",{className:"text-3xl font-black leading-tight text-white text-center lg:text-left",children:"Ngân hàng câu hỏi"}),e.jsx("p",{className:"mt-1 text-white/90 dark:text-gray-300 text-center lg:text-left ",children:"Tìm kiếm, lọc theo môn/chương/độ khó/loại. Tạo đề từ nhiều nguồn."})]}),e.jsxs("div",{className:"flex items-center gap-3 justify-center w-full lg:w-auto",children:[e.jsxs(d,{to:"/app/questions/import",className:"inline-flex items-center gap-2 rounded-full bg-white/10 px-4 py-2 text-sm font-medium text-white ring-1 ring-white/30 hover:bg-white/15 dark:bg-white/5 dark:ring-white/10",children:[e.jsx(U,{className:"h-4 w-4"})," Nhập từ tài liệu"]}),e.jsxs(d,{to:"/app/questions/create",className:"inline-flex items-center gap-2 rounded-full bg-yellow-400 px-5 py-2 text-sm font-semibold text-emerald-950 shadow hover:brightness-105",children:[e.jsx(F,{className:"h-4 w-4"})," Thêm câu hỏi"]})]})]}),e.jsx(T,{distance:12,duration:7,className:"pointer-events-none absolute top-16 left-8",children:e.jsx("div",{className:"rounded-xl bg-gradient-to-br from-amber-300 to-rose-300 px-3 py-1 shadow-lg -rotate-6",children:e.jsx("span",{className:"text-xs font-black text-rose-700",children:"QUESTIONS"})})}),e.jsx(T,{distance:10,duration:6,className:"pointer-events-none absolute top-16 right-10",children:e.jsx("div",{className:"rounded-full bg-gradient-to-br from-purple-400 to-indigo-400 p-3 shadow-xl rotate-12",children:e.jsx(P,{className:"h-4 w-4 text-white"})})})]})]}),e.jsxs("div",{className:"relative z-10 mx-auto max-w-7xl px-6 pb-20",children:[e.jsxs(w.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},className:"mb-6 rounded-2xl border border-white/20 bg-white/10 p-4 backdrop-blur-md dark:border-gray-700 dark:bg-gray-800/50",children:[e.jsx("div",{className:"grid gap-3 md:grid-cols-5",children:e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1 block text-xs font-medium text-white/90 dark:text-gray-200",children:"Tìm kiếm"}),e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-white/80 px-3 py-2 ring-1 ring-black/10 focus-within:ring-2 focus-within:ring-emerald-400 dark:bg-slate-900/70 dark:ring-white/10",children:[e.jsx(G,{className:"h-4 w-4 text-emerald-600 dark:text-emerald-300"}),e.jsx("input",{value:r,onChange:t=>S(c)(t.target.value),placeholder:"Từ khóa: nội dung, môn, tags…",className:"w-full bg-transparent p-1 text-sm text-gray-800 placeholder:text-gray-500 focus:outline-none dark:text-gray-100 dark:placeholder:text-gray-400"})]})]})}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("label",{className:"inline-flex cursor-pointer items-center gap-2 text-xs text-gray-700 dark:text-gray-300",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:t=>S(L)(t.target.checked),className:"h-4 w-4 rounded border-white/20 bg-white/20 text-emerald-500 focus:ring-emerald-400 dark:border-gray-600"}),"Chỉ hiển thị câu hỏi đã kiểm duyệt"]}),e.jsxs("div",{className:"hidden items-center gap-2 text-xs text-white/90 dark:text-gray-300 md:flex",children:[e.jsx(M,{className:"h-4 w-4"})," ",n.length," kết quả"]})]})]}),E?e.jsx(Y,{}):n.length===0?e.jsx(Z,{}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:n.map(t=>e.jsx(J,{s:t,isFavorite:o.has(t.id),onToggleFavorite:$},t.id))}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-2",children:[e.jsxs("button",{onClick:()=>u(t=>Math.max(1,t-1)),disabled:i===1,className:"inline-flex items-center gap-1 rounded-full bg-white/10 px-3 py-1.5 text-sm text-white ring-1 ring-white/20 disabled:opacity-50 dark:bg-white/5 dark:ring-white/10",children:[e.jsx(K,{className:"h-4 w-4"})," Trước"]}),e.jsxs("span",{className:"text-sm text-white/90 dark:text-gray-300",children:["Trang ",i,"/",b]}),e.jsxs("button",{onClick:()=>u(t=>Math.min(b,t+1)),disabled:i===b,className:"inline-flex items-center gap-1 rounded-full bg-white/10 px-3 py-1.5 text-sm text-white ring-1 ring-white/20 disabled:opacity-50 dark:bg-white/5 dark:ring-white/10",children:["Sau ",e.jsx(D,{className:"h-4 w-4"})]})]})]})]})]})}function J({s:r,isFavorite:c,onToggleFavorite:y}){return e.jsxs(w.div,{initial:{opacity:0,y:18},whileInView:{opacity:1,y:0},viewport:{once:!0},transition:{type:"spring",stiffness:160,damping:16},whileHover:{y:-4,scale:1.01},className:"relative rounded-xl border border-emerald-100/60 bg-white p-4 shadow-lg transition dark:border-slate-800 dark:bg-slate-900",children:[e.jsxs("div",{className:"mb-2 flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("span",{className:"inline-flex items-center gap-1 rounded-md bg-emerald-100 px-2 py-0.5 text-xs font-semibold text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-100",children:[e.jsx(B,{className:"h-3 w-3"}),r.code]})}),e.jsx("h3",{className:"mt-1 truncate text-base font-bold text-emerald-900 dark:text-emerald-200",children:r.name})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(d,{to:`/questions/subject/${r.id}/edit`,className:"rounded-full bg-red-400 px-3 py-1.5 text-xs font-semibold text-emerald-950 shadow hover:brightness-105",children:"Sửa"}),e.jsx(d,{to:`/questions/subject/${r.id}`,className:"rounded-full bg-yellow-400 px-3 py-1.5 text-xs font-semibold text-emerald-950 shadow hover:brightness-105",children:"Xem"}),e.jsx("button",{onClick:()=>y(r.id),className:"transition hover:scale-105 active:scale-95","aria-label":c?"Bỏ yêu thích":"Thêm vào yêu thích",children:c?e.jsx(C,{className:"w-8 h-8 text-red-500 fill-red-500"}):e.jsx(C,{className:"w-8 h-8 text-red-500"})})]})]}),r.description?e.jsx("p",{className:"line-clamp-3 text-sm text-gray-700 dark:text-gray-300",children:r.description}):e.jsx("p",{className:"text-sm italic text-gray-500 dark:text-gray-400",children:"Chưa có mô tả"}),e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-emerald-900/70 dark:text-slate-300/70",children:[e.jsx(O,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:["Tạo lúc: ",new Date(r.createdAt).toLocaleString()]})]})]})}function Y(){return e.jsx("div",{className:"grid place-items-center rounded-2xl border border-dashed border-emerald-300/40 p-10 text-center dark:border-slate-700",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"mb-2 h-8 w-48 rounded bg-emerald-200/60 dark:bg-emerald-500/20"}),e.jsx("div",{className:"mx-auto h-8 w-72 rounded bg-emerald-200/40 dark:bg-emerald-500/10"})]})})}function Z(){return e.jsx("div",{className:"grid place-items-center rounded-2xl border border-dashed border-emerald-300/40 p-10 text-center dark:border-slate-700",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs("div",{className:"mb-2 inline-flex items-center gap-2 rounded-full bg-emerald-100 px-3 py-1 text-xs font-semibold text-emerald-800 dark:bg-emerald-500/20 dark:text-emerald-100",children:[e.jsx(M,{className:"h-4 w-4"})," Không có kết quả phù hợp"]}),e.jsx("p",{className:"text-sm text-emerald-900/80 dark:text-slate-300/80",children:"Hãy thử từ khóa khác hoặc bỏ bớt bộ lọc."}),e.jsx("div",{className:"mt-4 flex justify-center gap-2",children:e.jsxs(d,{to:"/app/questions/create",className:"inline-flex items-center gap-2 rounded-full bg-yellow-400 px-4 py-2 text-sm font-semibold text-emerald-950 shadow hover:brightness-105",children:[e.jsx(F,{className:"h-4 w-4"})," Thêm môn học mới"]})})]})})}export{ne as default};
