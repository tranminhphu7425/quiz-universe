import{c as f,f as D,d as Q,r as c,j as e,L as C,e as _,m as G}from"./index-ffUkryhB.js";import{C as R}from"./circle-check-B6HzvrFZ.js";/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],$=f("arrow-left",U);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]],J=f("plus",X);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],F=f("save",W);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]],M=f("trash-2",Y);/**
 * @license lucide-react v0.540.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]],ee=f("wand-sparkles",Z),v="http://localhost:8080/api",te=/\.{5,}/g;function m(d){return String.fromCharCode(65+d)}function se(d){let l=0;for(;te.exec(d)!==null;)l++;return l}function g(d){return d.slice().sort((l,h)=>(l.sortOrder??0)-(h.sortOrder??0)).map((l,h)=>({...l,sortOrder:h}))}function re(){const{subjectId:d,questionId:l}=D(),h=Q(),i=!l||l==="new",b=Number(d),p=i?null:Number(l),[E,j]=c.useState(!0),[N,y]=c.useState(!1),[w,u]=c.useState(null),[a,o]=c.useState(()=>({id:0,stem:"",explanation:"",questionType:"mcq_single",status:"approved",createdAt:"",options:[0,1,2,3].map(t=>({id:-1-t,label:m(t),content:"",isCorrect:t===0,sortOrder:t}))}));c.useEffect(()=>{let t=new AbortController;return i?(j(!1),()=>t.abort()):((async()=>{try{j(!0),u(null);const s=await fetch(`${v}/questions/${p}`,{signal:t.signal});if(!s.ok)throw new Error(`HTTP ${s.status}`);const n=await s.json();o(r=>({...n,options:g(n.options??[])}))}catch(s){if(s?.name==="AbortError")return;u(s?.message||"Không thể tải dữ liệu câu hỏi.")}finally{j(!1)}})(),()=>t.abort())},[i,p]);const x=c.useMemo(()=>se(a.stem??""),[a.stem]),q=c.useMemo(()=>a.questionType==="mcq_single"?a.options.some(t=>t.isCorrect):!0,[a.questionType,a.options]),S=t=>o(s=>({...s,stem:t})),L=t=>o(s=>({...s,explanation:t})),O=t=>o(s=>({...s,questionType:t,options:g((s.options??[]).map((n,r)=>({...n,isCorrect:t==="mcq_single"?r===0:!1})))})),H=()=>o(t=>{const s=t.options?.length??0,n={id:-1-s,label:m(s),content:"",isCorrect:t.questionType==="mcq_single"?s===0:!1,sortOrder:s};return{...t,options:g([...t.options??[],n])}}),P=t=>o(s=>{const n=(s.options??[]).slice();return n.splice(t,1),{...s,options:g(n.map((r,k)=>({...r,label:m(k)})))}}),T=(t,s)=>o(n=>{const r=(n.options??[]).slice();return r[t]={...r[t],...s},{...n,options:r}}),A=t=>o(s=>({...s,options:(s.options??[]).map((n,r)=>({...n,isCorrect:r===t}))})),V=()=>{if(!a.stem.trim())return"Vui lòng nhập đề bài (stem).";if(a.questionType==="mcq_single"){if((a.options?.length??0)<2)return"Cần ít nhất 2 phương án trả lời.";if(!q)return"Hãy chọn một đáp án đúng.";if(a.options.some(s=>!s.content.trim()))return"Nội dung phương án không được để trống."}if(a.questionType==="fill_in"){if(x===0)return"Không phát hiện ô trống trong đề bài. Hãy dùng '.....' để tạo ô trống.";if((a.options?.length??0)<x)return`Số đáp án hiện có (${a.options.length}) ít hơn số ô trống (${x}).`;if(a.options.slice(0,x).some(s=>!s.content.trim()))return"Vui lòng điền đáp án đúng cho tất cả ô trống."}return null},z=async()=>{const t=V();if(t){u(t);return}try{y(!0),u(null);const s={...a,options:g(a.options??[]).map((I,K)=>({...I,sortOrder:K}))},n=i?`${v}/questions`:`${v}/questions/${p}`,k=await fetch(n,{method:i?"POST":"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!k.ok)throw new Error(`HTTP ${k.status}`);h(`/questions/${b}`)}catch(s){u(s?.message||"Lưu thất bại")}finally{y(!1)}},B=async()=>{if(!(i||!p)&&confirm("Bạn có chắc muốn xóa câu hỏi này?"))try{y(!0);const t=await fetch(`${v}/questions/${p}`,{method:"DELETE"});if(!t.ok)throw new Error(`HTTP ${t.status}`);h(`/questions/${b}`)}catch(t){u(t?.message||"Không thể xóa")}finally{y(!1)}};return e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900",children:[e.jsxs("section",{className:"relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-emerald-600 via-green-600 to-emerald-500 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900"}),e.jsxs("div",{className:"relative z-10 mx-auto flex max-w-7xl items-center justify-between gap-6 px-6 py-10 text-white",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"mb-2 inline-flex items-center gap-2 rounded-full bg-white/10 px-3 py-1 text-xs font-semibold ring-1 ring-white/20 backdrop-blur",children:[e.jsx(ee,{className:"h-4 w-4"})," QuizUniverse • Chỉnh sửa câu hỏi"]}),e.jsx("h1",{className:"text-[1.75rem] md:text-[2.2rem] font-black leading-tight",children:i?"Tạo câu hỏi mới":`Sửa câu hỏi #${p}`}),e.jsxs("p",{className:"mt-1 text-white/90",children:["Môn học: ",e.jsx("b",{children:b})]})]}),e.jsx("div",{className:"flex items-center gap-3",children:e.jsxs(C,{to:`/questions/${b}`,className:"inline-flex items-center gap-2 rounded-xl bg-white/10 px-4 py-2 text-sm ring-1 ring-white/20 hover:brightness-110",children:[e.jsx($,{className:"h-4 w-4"})," Quay lại danh sách"]})})]})]}),e.jsxs("main",{className:"mx-auto max-w-5xl px-6 py-8",children:[w&&e.jsx("div",{className:"mb-4 rounded-xl bg-rose-50 p-3 text-rose-700 ring-1 ring-rose-200 dark:bg-rose-900/20 dark:text-rose-300 dark:ring-rose-800",children:w}),E?e.jsxs("div",{className:"flex items-center gap-2 text-slate-600 dark:text-slate-300",children:[e.jsx(_,{className:"h-4 w-4 animate-spin"})," Đang tải..."]}):e.jsxs(G.div,{initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{type:"spring",stiffness:160,damping:18},className:"rounded-2xl border border-emerald-100 bg-white p-5 shadow-sm dark:border-slate-800 dark:bg-slate-900",children:[e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Đề bài (stem)"}),e.jsx("textarea",{value:a.stem,onChange:t=>S(t.target.value),className:"h-28 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-slate-800 shadow-sm outline-none ring-emerald-200 focus:border-emerald-400 focus:ring-2 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100",placeholder:a.questionType==="fill_in"?"Nhập đề và dùng '.....' để tạo ô trống":"Nhập đề bài"}),a.questionType==="fill_in"&&e.jsxs("p",{className:"mt-1 text-xs text-slate-500 dark:text-slate-400",children:["Phát hiện ",e.jsx("b",{children:x})," ô trống trong đề bài (dựa vào dãy dấu chấm)."]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Loại câu hỏi"}),e.jsxs("select",{value:a.questionType,onChange:t=>O(t.target.value),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-slate-800 shadow-sm outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"mcq_single",children:"Trắc nghiệm 1 đáp án"}),e.jsx("option",{value:"fill_in",children:"Điền vào chỗ trống"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Trạng thái"}),e.jsxs("select",{value:a.status??"draft",onChange:t=>o(s=>({...s,status:t.target.value})),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-slate-800 shadow-sm outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100",children:[e.jsx("option",{value:"draft",children:"Bản nháp"}),e.jsx("option",{value:"approved",children:"Duyệt"})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"mb-1 block text-sm font-medium text-slate-700 dark:text-slate-200",children:"Giải thích (tuỳ chọn)"}),e.jsx("textarea",{value:a.explanation??"",onChange:t=>L(t.target.value),className:"h-24 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-slate-800 shadow-sm outline-none ring-emerald-200 focus:border-emerald-400 focus:ring-2 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-100",placeholder:"Giải thích hoặc ghi chú..."})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-semibold text-slate-800 dark:text-slate-100",children:a.questionType==="mcq_single"?"Phương án trả lời":"Đáp án cho các ô trống"}),e.jsx("div",{className:"text-xs text-slate-500 dark:text-slate-400",children:a.questionType==="mcq_single"?q?e.jsxs("span",{className:"inline-flex items-center gap-1 text-emerald-600 dark:text-emerald-400",children:[e.jsx(R,{className:"h-4 w-4"})," Đã chọn đáp án đúng"]}):e.jsx("span",{className:"text-rose-600 dark:text-rose-400",children:"Chưa chọn đáp án đúng"}):e.jsxs("span",{children:["Hãy điền đúng ",x," đáp án (theo thứ tự ô trống)."]})})]}),e.jsx("div",{className:"space-y-3",children:g(a.options).map((t,s)=>e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border border-slate-200 bg-white p-3 dark:border-slate-700 dark:bg-slate-800",children:[a.questionType==="mcq_single"?e.jsx("input",{type:"radio",name:"correct",className:"mt-2 h-4 w-4 accent-emerald-700",checked:!!t.isCorrect,onChange:()=>A(s),title:"Đánh dấu là đáp án đúng"}):e.jsx("span",{className:"mt-1 inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100 text-xs font-bold text-slate-700 dark:bg-slate-700 dark:text-slate-200",children:m(s)}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[a.questionType==="mcq_single"&&e.jsx("span",{className:"inline-flex h-6 w-6 items-center justify-center rounded-md bg-slate-100 text-slate-700 dark:bg-slate-700 dark:text-slate-200",children:m(s)}),e.jsx("input",{value:t.content,onChange:n=>T(s,{content:n.target.value}),className:"w-full rounded-lg border border-slate-300 bg-white px-3 py-2 text-slate-800 outline-none focus:border-emerald-400 focus:ring-2 focus:ring-emerald-200 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-100",placeholder:a.questionType==="mcq_single"?`Nội dung phương án ${m(s)}`:`Đáp án cho ô trống ${m(s)}`})]}),e.jsx("div",{className:"mt-2 flex items-center gap-3 text-xs text-slate-500",children:e.jsxs("label",{className:"inline-flex items-center gap-1",children:["Thứ tự:",e.jsx("input",{type:"number",value:t.sortOrder??s,onChange:n=>T(s,{sortOrder:Number(n.target.value)}),className:"w-16 rounded-md border border-slate-300 bg-white px-2 py-1 text-slate-700 outline-none focus:border-emerald-400 focus:ring-1 focus:ring-emerald-200 dark:border-slate-600 dark:bg-slate-900 dark:text-slate-200"})]})})]}),e.jsx("div",{className:"flex shrink-0 items-center gap-2",children:e.jsx("button",{type:"button",onClick:()=>P(s),className:"inline-flex items-center gap-1 rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-700 hover:bg-slate-50 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-700",title:"Xóa phương án",children:e.jsx(M,{className:"h-4 w-4"})})})]},`${t.id}-${s}`))}),e.jsx("div",{className:"mt-3",children:e.jsxs("button",{type:"button",onClick:H,className:"inline-flex items-center gap-2 rounded-xl border border-emerald-300 bg-emerald-50 px-4 py-2 text-sm font-medium text-emerald-700 hover:bg-emerald-100 dark:border-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-300",children:[e.jsx(J,{className:"h-4 w-4"})," Thêm phương án"]})})]}),e.jsxs("div",{className:"mt-8 flex flex-wrap items-center gap-3",children:[e.jsxs("button",{type:"button",onClick:z,disabled:N,className:"inline-flex items-center gap-2 rounded-xl bg-emerald-600 px-5 py-2.5 text-white shadow hover:brightness-110 disabled:opacity-60",children:[N?e.jsx(_,{className:"h-4 w-4 animate-spin"}):e.jsx(F,{className:"h-4 w-4"}),"Lưu"]}),!i&&e.jsxs("button",{type:"button",onClick:B,disabled:N,className:"inline-flex items-center gap-2 rounded-xl bg-rose-600 px-5 py-2.5 text-white shadow hover:brightness-110 disabled:opacity-60",children:[e.jsx(M,{className:"h-4 w-4"})," Xóa"]}),e.jsxs(C,{to:`/questions/${b}`,className:"ml-auto inline-flex items-center gap-2 rounded-xl border border-slate-200 px-5 py-2.5 text-slate-700 hover:bg-slate-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800",children:[e.jsx($,{className:"h-4 w-4"})," Hủy"]})]})]})]})]})}export{re as default};
